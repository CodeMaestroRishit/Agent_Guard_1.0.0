<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ApexGuard Dashboard</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <!-- Header -->
  <header>
    <nav>
      <a href="/static/dashboard.html" class="logo">üõ°Ô∏è ApexGuard</a>
      <div class="nav-links">
        <a href="/static/dashboard.html" class="active">Dashboard</a>
      </div>
      <button id="dark-mode-toggle" class="dark-mode-toggle" aria-label="Toggle dark mode" title="Toggle dark mode">
        <span class="dark-mode-icon">üåô</span>
        <span class="light-mode-icon" style="display: none;">‚òÄÔ∏è</span>
      </button>
    </nav>
  </header>

  <!-- Tab Navigation -->
  <div class="tab-nav">
    <button class="tab-btn active" data-tab="overview" aria-label="Overview tab">Overview</button>
    <button class="tab-btn" data-tab="anomalies" aria-label="Anomalies tab">Anomalies</button>
    <button class="tab-btn" data-tab="policies" aria-label="Policies tab">Policies</button>
    <button class="tab-btn" data-tab="tools" aria-label="Tools tab">Tools</button>
    <button class="tab-btn" data-tab="simulator" aria-label="Simulator tab">Simulator</button>
    <button class="tab-btn" data-tab="ai-policy" aria-label="AI Policy tab">AI Policy</button>
  </div>

  <div class="container">
    <!-- Overview Tab -->
    <div class="tab-content active" id="tab-overview">
      <div class="overview-layout">
        <!-- Left Sidebar -->
        <aside class="sidebar" id="sidebar">
          <button class="sidebar-toggle" id="sidebar-toggle" aria-label="Toggle sidebar">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M3 9l5 5 5-5H3z"/>
            </svg>
          </button>
          
          <!-- Agents Panel -->
          <div class="sidebar-panel">
            <div class="panel-header">
              <h3>Agents</h3>
            </div>
            <div class="panel-search">
              <svg class="search-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
              </svg>
              <input type="text" id="agent-search" placeholder="Search agents..." aria-label="Search agents">
            </div>
            <div class="panel-list" id="agents-list">
              <div class="loading">Loading agents...</div>
            </div>
          </div>

          <!-- Tools Panel -->
          <div class="sidebar-panel">
            <div class="panel-header">
              <h3>Tools</h3>
            </div>
            <div class="panel-list" id="tools-list">
              <div class="loading">Loading tools...</div>
            </div>
          </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
          <!-- Filter Pill -->
          <div id="filter-pill-container" class="filter-pill-container" style="display: none;">
            <span class="filter-pill">
              <span id="filter-pill-text"></span>
              <button id="clear-filter-btn" class="clear-filter-btn" aria-label="Clear filter">√ó</button>
            </span>
          </div>

          <!-- Audit Table -->
          <div class="card">
            <div class="card-header">
              <h2>Audit Logs</h2>
              <div class="table-controls">
                <button class="btn-secondary" id="load-more-btn" style="display: none;">Load More</button>
                <span class="text-small text-muted" id="audit-count">0 entries</span>
              </div>
            </div>
            <div class="table-wrapper">
              <table id="audit-table">
                <thead>
                  <tr>
                    <th><button class="sort-btn" data-sort="time">Time ‚Üï</button></th>
                    <th>Agent</th>
                    <th>Tool</th>
                    <th>Decision</th>
                    <th>Reason</th>
                    <th>Policy</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td colspan="6" class="loading">Loading audit logs...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </main>

        <!-- Right Sidebar - Anomalies Card -->
        <aside class="anomalies-sidebar">
          <div class="card">
            <div class="card-header">
              <h3>Anomalies</h3>
              <span class="badge" id="anomaly-badge">0</span>
            </div>
            <div id="anomalies-preview">
              <div class="loading">Loading...</div>
            </div>
            <button class="btn-secondary" id="view-all-anomalies">View All</button>
          </div>
        </aside>
      </div>
    </div>

    <!-- Anomalies Tab -->
    <div class="tab-content" id="tab-anomalies">
      <div class="card">
        <div class="card-header">
          <h2>Anomalies</h2>
        </div>
        <div id="anomalies-list">
          <div class="loading">Loading anomalies...</div>
        </div>
      </div>
    </div>

    <!-- Policies Tab -->
    <div class="tab-content" id="tab-policies">
      <div class="card">
        <div class="card-header">
          <h2>Apply New Policy</h2>
        </div>
        <div class="form-group">
          <label for="policy-input">Policy JSON</label>
          <textarea id="policy-input" rows="12" placeholder='{"name":"my-policy","version":"1.0.0","created_by":"admin","rules":[...]}'></textarea>
          <div id="policy-json-error" class="error-message" style="display: none;"></div>
        </div>
        <div style="display: flex; gap: 0.75rem;">
          <button type="button" id="validate-policy-btn">Validate JSON</button>
          <button type="button" id="apply-policy-btn">Apply Policy</button>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h2>Policies</h2>
          <div class="search-wrapper" style="max-width: 300px;">
            <svg class="search-icon" width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
              <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"/>
            </svg>
            <input type="text" id="policy-search" placeholder="Search policies..." aria-label="Search policies">
          </div>
        </div>
        <div id="policies-container" class="card-grid">
          <div class="loading">Loading policies...</div>
        </div>
      </div>
    </div>

    <!-- Tools Tab -->
    <div class="tab-content" id="tab-tools">
      <div class="card">
        <div class="card-header">
          <h2>Tool Registry</h2>
          <span class="badge badge-success">MCP Tools</span>
        </div>
        <div id="tools-container" class="card-grid">
          <div class="loading">Loading tools...</div>
        </div>
      </div>
    </div>

    <!-- Simulator Tab -->
    <div class="tab-content" id="tab-simulator">
      <div class="card">
        <div class="card-header">
          <h2>Manual Enforcement Simulator</h2>
          <span class="badge badge-warning">Test Mode</span>
        </div>
        <form id="sim-form">
          <div class="form-group">
            <label for="preset-select">Quick Preset</label>
            <select id="preset-select" class="control-select" aria-label="Select preset">
              <option value="">-- Select Preset --</option>
            </select>
          </div>
          <div class="form-group">
            <label for="agent_id">Agent ID</label>
            <input type="text" id="agent_id" name="agent_id" placeholder="e.g., agent-reader" required>
          </div>
          <div class="form-group">
            <label for="agent_roles">Agent Roles (comma-separated)</label>
            <input type="text" id="agent_roles" name="agent_roles" placeholder="e.g., reader, auditor" required>
          </div>
          <div class="form-group">
            <label for="tool_id">Tool ID</label>
            <input type="text" id="tool_id" name="tool_id" placeholder="e.g., mcp:read_logs" required>
          </div>
          <div class="form-group">
            <label for="tool_version">Tool Version</label>
            <input type="text" id="tool_version" name="tool_version" placeholder="e.g., 1.0.0" value="1.0.0">
          </div>
          <div class="form-group">
            <label for="params">Parameters (JSON)</label>
            <textarea id="params" name="params" placeholder='{"limit": 5}'></textarea>
            <div id="params-json-error" class="error-message" style="display: none;"></div>
          </div>
          <div class="form-group">
            <label for="request_id">Request ID</label>
            <input type="text" id="request_id" name="request_id" placeholder="e.g., req-123" required>
          </div>
          <button type="submit">Enforce</button>
        </form>
      </div>
      <div class="card">
        <div class="card-header">
          <h2>Response</h2>
        </div>
        <pre id="sim-result" class="response-panel">Waiting for request...</pre>
      </div>
    </div>

    <!-- AI Policy Tab -->
    <div class="tab-content" id="tab-ai-policy">
      <div class="card">
        <div class="card-header">
          <h2>AI Policy Generator</h2>
          <span class="badge badge-success">Gemini</span>
        </div>
        <div class="ai-policy-layout">
          <div class="ai-policy-input">
            <div class="form-group">
              <label for="nl-policy-input">Describe policy in plain English</label>
              <textarea id="nl-policy-input" rows="8" placeholder="e.g., Auditors may read logs but cannot modify policies. Readers can only access read_logs tool with limit <= 10."></textarea>
            </div>
            <div class="form-group" style="display: flex; gap: 0.75rem; align-items: center;">
              <label for="model-select" style="margin: 0;">Model:</label>
              <select id="model-select" class="control-select">
                <option value="models/gemini-2.5-pro">Gemini 2.5 Pro</option>
                <option value="models/gemini-2.5-flash">Gemini 2.5 Flash</option>
              </select>
              <button type="button" id="generate-policy-btn">Generate</button>
            </div>
          </div>
          <div class="ai-policy-output">
            <div class="card" style="margin-bottom: 1rem;">
              <div class="card-header">
                <h3>Generated Policy</h3>
                <button class="btn-secondary" id="copy-policy-btn" style="display: none;" aria-label="Copy policy JSON">
                  <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor">
                    <path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2Zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6ZM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1H2Z"/>
                  </svg>
                  Copy
                </button>
              </div>
              <pre id="generated-policy-output" class="json-viewer">No policy generated yet. Enter a description and click Generate.</pre>
            </div>
            <button type="button" id="apply-generated-policy-btn" class="btn-primary" style="display: none;">Apply Policy</button>
          </div>
        </div>
        <div class="card" style="margin-top: 1.5rem;">
          <div class="card-header">
            <h3>Generation Log</h3>
          </div>
          <div id="generation-log" class="log-panel">
            <div class="text-muted text-small">No generations yet</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- JSON Modal -->
  <div id="json-modal" class="modal-json" role="dialog" aria-labelledby="modal-title" aria-hidden="true">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="modal-title">Policy JSON</h2>
        <button class="modal-close" aria-label="Close modal">√ó</button>
      </div>
      <div class="modal-body">
        <pre id="modal-json-content"><code></code></pre>
      </div>
    </div>
  </div>

  <!-- Example Payload Modal -->
  <div id="example-modal" class="modal-json" role="dialog" aria-labelledby="example-modal-title" aria-hidden="true">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="example-modal-title">Example Payloads</h2>
        <button class="modal-close" aria-label="Close modal">√ó</button>
      </div>
      <div class="modal-body">
        <div id="example-payloads-content"></div>
      </div>
    </div>
  </div>

  <script src="/static/script.js"></script>
</body>
</html>
